{% load static %}
<div class="w-[90vw] h-[60vh] mx-auto relative mt-4 rounded-lg overflow-hidden mb-4">
    <img src="{{ image }}" class="absolute w-full h-full object-cover">
    <div class="absolute bottom-4 left-4 h-48 max-w-lg bg-white/30 backdrop-blur-md hover:bg-white rounded-xl p-8 space-y-2 text-white">
        <p class="text-gray-500 bg-white/50 inline px-2 py-1 rounded-lg">Let's Cook</p>
        <div class="bg-white/50 px-2 py-1 rounded-lg text-black space-y-2">
            <h1 class="text-4xl"><span class="text-orange-600">{{ recipe.title | capfirst }} </span>Recipe</h1>
            <h2 class="text-3xl">{{ recipe.cuisine }} Food</h2>
        </div>
    </div>

  {% if recipe.author == user %}
        <a href="{% url 'recipe_management:edit_recipe' recipe.id %}" 
           class="absolute top-4 right-4 bg-white/50 hover:bg-white text-black px-3 py-2 rounded-lg flex items-center space-x-2 z-10">
            <i class="bi bi-pencil-square"></i>
            <span>Edit Recipe</span>
        </a>
    {% elif user.is_authenticated %}

        <div class="absolute top-4 right-4 flex bg-gray-50/40 p-4 space-x-2 rounded-xl">
          <button class=" grid grid-cols-3 overflow-hidden w-32 rounded-tl-full rounded-bl-full
               z-10"
              data-recipe-id="{{ recipe.id }}" id="like-btn">
          <div id="like-status" class="col-span-2 px-2 py-1 {%if liked%} bg-red-500 text-white {% else %}  bg-white {% endif %} ">{% if liked %}Liked{% else %}Like{% endif %}</div>
          <div class="bg-black text-white px-3 py-1 self-stretch" id="like-count"> {{recipe.total_likes}}</div>
        </button>

        <div></div>
        </div>
  
        </div>

      <script>
document.addEventListener('DOMContentLoaded', function() {
  const likeBtn = document.getElementById('like-btn');
  if (likeBtn) {
    likeBtn.addEventListener('click', function() {
      const recipeId = likeBtn.getAttribute('data-recipe-id');
      // build the URL server-side so it respects your app's URL configuration
      const url = "{% url 'recipe_management:toggle_like' recipe.id %}";

      // get CSRF token from cookie (more reliable than embedding template token in JS)
      function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
              cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
              break;
            }
          }
        }
        return cookieValue;
      }

      fetch(url, {
        method: 'POST',
        headers: {
          'X-CSRFToken': getCookie('csrftoken'),
          'X-Requested-With': 'XMLHttpRequest',
        },
      })
      .then(response => response.json())
      .then(data => {
        const likeCount = document.getElementById('like-count');
        const likestatus = document.getElementById('like-status');
        likeCount.textContent = data.total_likes;

        if (data.liked) {
          likestatus.classList.add('bg-red-500', 'text-white');
          likestatus.classList.remove('bg-white');
          likestatus.textContent = 'Liked';
        } else {
          likestatus.classList.remove('bg-red-500', 'text-white');
          likestatus.classList.add('bg-white');
          likestatus.textContent = 'Like';
        }
      });
    });
  }
});
</script>
    {% endif %}



