{% load widget_tweaks %}

<div class="grid grid-cols-1 md:grid-cols-2 gap-6 flex flex-col ">
  
  {% for field in recipe_image %}
    {% if field.name == "image" %}
      <div class="relative w-64 h-64  bg-white rounded-lg cursor-pointer overflow-hidden group">
        <!-- Hidden file input -->
        {{ field|add_class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" }}

        <!-- Placeholder content -->
        <div class="flex flex-col items-center justify-center h-full text-sky-400 placeholder-content transition duration-200">
          <i class="bi bi-plus text-5xl mb-2"></i>
          <span class="font-semibold">Add Image</span>
        </div>

        <!-- Preview image (always rendered, hidden initially) -->
        <img id="image-preview-{{ forloop.counter }}" 
             class="absolute inset-0 w-full h-full object-cover hidden z-0" 
             alt="Recipe Image Preview">

        <!-- Show existing image if any -->
        {% if recipe_image.instance and recipe_image.instance.image %}
          <script>
            document.addEventListener('DOMContentLoaded', function() {
              const preview = document.getElementById('image-preview-{{ forloop.counter }}');
              const placeholder = preview.parentElement.querySelector('.placeholder-content');
              preview.src = "{{ recipe_image.instance.image.url }}";
              preview.classList.remove('hidden');
              placeholder.classList.add('hidden');
            });
          </script>
        {% endif %}
      </div>
    {% else %}
      <!-- Other fields like caption -->
      <div class="flex flex-col">
        <label for="{{ field.id_for_label }}" class="flex items-center gap-2 text-sm font-semibold text-gray-700 mb-1">
          <i class="bi bi-card-text text-sky-500"></i>
          {{ field.label }}
        </label>
        {{ field|add_class:"block w-full rounded-lg border border-sky-400 focus:border-sky-400 focus:ring focus:ring-sky-100 text-gray-700 px-3 py-2 placeholder-sky-300 transition" }}
        {% if field.errors %}
          <p class="text-sm text-red-600 mt-1">{{ field.errors|join:", " }}</p>
        {% endif %}
      </div>
    {% endif %}
  {% endfor %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const fileInputs = document.querySelectorAll('input[type="file"]');
  fileInputs.forEach(input => {
    input.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;

      const parentDiv = input.parentElement;
      const preview = parentDiv.querySelector('img');
      const placeholder = parentDiv.querySelector('.placeholder-content');

      if (preview) {
        preview.src = URL.createObjectURL(file);
        preview.classList.remove('hidden');
      }
      if (placeholder) {
        placeholder.classList.add('hidden');
      }
    });
  });
});
</script>
